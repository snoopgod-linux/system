#!/usr/bin/env bash
#
# [Release]: SnoopGod 22.04.4 LTS amd64
# [Website]: https://snoopgod.com/releases/?ver=22.04.4
# [License]: http://www.gnu.org/licenses/gpl-3.0.html

## ---------------- ##
## DEFINE VARIABLES ##
## ---------------- ##

## Colour output
## -------------
texterror="\033[01;31m"		# Error
textreset="\033[00m"		# Reset

## ------------------- ##
## PREPARE ENVIRONMENT ##
## ------------------- ##

## Clear screen
## ------------
function clearscreen()
{
	clear
	sleep 2s
}

## Warning
## -------
function showwarning()
{
	echo
    echo -e "${texterror}*** Warning ***${textreset}"
    echo -e "${texterror}You are about to clean all user temporary cached files and folders${textreset}"
    echo -e "${texterror}We recommend to exit all other programs before to proceed${textreset}"
    echo
    read -p "Do you want to continue? [y/N] " yn
    case $yn in
        [Yy]* )
			echo
            ;;
        [Nn]* )
            exit
            ;;
        * )
            exit
            ;;
    esac
}

## Secure delete
## -------------
function securedelete()
{
    path=$1
	if [ -d "$path" ];
	then
		srm -f -r -v $path >/dev/null 2>&1
	elif [ -f "$path" ];
	then
		srm -f -v $path >/dev/null 2>&1
	fi
}

## -------------- ##
## DEFINE ACTIONS ##
## -------------- ##

## Delete Chrome cache
## -------------------
function deletecachechrome()
{
    read -p "[?] Do you want to delete Chrome cache? [y/N] " yn
    case $yn in
        [Yy]* )
			rm -rf $HOME/.cache/google-chrome/*
		    rm -rf $HOME/.config/google-chrome/Default/*
			echo -e "[+] Chrome cache folder deleted\n"
            ;;
        [Nn]* )
			echo -e "[!] Chrome cache folder not deleted\n"
			;;
        * )
            deletecachechrome
            ;;
    esac
}

## Delete Filezilla cache
## ----------------------
function deletecachefilezilla()
{
    read -p "[?] Do you want to delete Filezilla cache? [y/N] " yn
    case $yn in
        [Yy]* )
		    securedelete -rf $HOME/.config/filezilla/queue.sqlite3
		    securedelete -rf $HOME/.config/filezilla/recentservers.xml
			echo -e "[+] Filezilla cache folder deleted\n"
            ;;
        [Nn]* )
			echo -e "[!] Filezilla cache folder not deleted\n"
			;;
        * )
            deletecachefilezilla
            ;;
    esac
}

## Delete Firefox cache
## --------------------
function deletecachefirefox()
{
    read -p "[?] Do you want to delete Firefox cache? [y/N] " yn
    case $yn in
        [Yy]* )
			securedelete $HOME/Downloads/firefox.tmp
			echo -e "[+] Firefox cache folder deleted\n"
            ;;
        [Nn]* )
			echo -e "[!] Firefox cache folder not deleted\n"
			;;
        * )
            deletecachefirefox
            ;;
    esac
}

## Delete Jetbrains cache
## ----------------------
function deletecachejetbrains()
{
	if [ -d "$HOME/.config/JetBrains" ];
	then
	    read -p "[?] Do you want to delete Jetbrains cache? [y/N] " yn
	    case $yn in
	        [Yy]* )
				rm -rf $HOME/Android
				rm -rf $HOME/.android
				rm -rf $HOME/.config/Google/AndroidStudio*
				rm -rf $HOME/.config/JetBrains
				rm -rf $HOME/.cache/Google/AndroidStudio*
				rm -rf $HOME/.cache/JetBrains
				rm -rf $HOME/.cache/JNA
				echo -e "[+] Jetbrains cache deleted\n"
			    ;;
	        [Nn]* )
				echo -e "[!] Jetbrains cache not deleted\n"
	            ;;
	        * )
	            deletecachejetbrains
	            ;;
	    esac
	fi
}

## Delete KeePassXC cache
## ----------------------
function deletecachekeepassxc()
{
    read -p "[?] Do you want to delete KeePassXC cache? [y/N] " yn
    case $yn in
        [Yy]* )
			rm -rf $HOME/.cache/keepassxc
			echo -e "[+] KeePassXC cache deleted\n"
            ;;
        [Nn]* )
			echo -e "[+] KeePassXC cache not deleted\n"
            ;;
        * )
            deletecachekeepassxc
            ;;
    esac
}

## Delete cache thumbnails
## -----------------------
function deletecachethumbs()
{
    read -p "[?] Do you want to delete thumbnails cache? [y/N] " yn
    case $yn in
        [Yy]* )
			rm -rf $HOME/.cache/thumbnails/*
			echo -e "[+] Thumbnails cache deleted\n"
            ;;
        [Nn]* )
			echo -e "[+] Thumbnails cache not deleted\n"
            ;;
        * )
            deletecachethumbs
            ;;
    esac
}

## Delete recent files history
## ---------------------------
function deleterecentfiles()
{
    read -p "[?] Do you want to delete the recent files logs? [y/N] " yn
    case $yn in
        [Yy]* )
			securedelete $HOME/.local/share/recently-used.xbel
			securedelete $HOME/.msf4/history
			echo -e "[+] Recent files logs deleted\n"
            ;;
        [Nn]* )
			echo -e "[!] Recent Files logs not deleted\n"
            ;;
        * )
            deleterecentfiles
            ;;
    esac
}

## Delete SSH keys
## ---------------
function deletesshkeys()
{
    read -p "[?] Do you want to delete SSH keys? [y/N] " yn
    case $yn in
        [Yy]* )
			securedelete $HOME/.ssh/authorized_keys
			securedelete $HOME/.ssh/known_hosts
			securedelete $HOME/.ssh/known_hosts.old
			echo -e "[+] SSH keys deleted\n"
            ;;
        [Nn]* )
			echo -e "[!] SSH keys not deleted\n"
            ;;
        * )
            deletesshkeys
            ;;
    esac
}

## Delete SNAP directory
## ---------------------
function deletesnapdirectory()
{
    read -p "[?] Do you want to delete Snap directory? [y/N] " yn
    case $yn in
        [Yy]* )
			rm -rf $HOME/snap
			echo -e "[+] Snap directory deleted\n"
            ;;
        [Nn]* )
			echo -e "[!] Snap directory not deleted\n"
            ;;
        * )
            deletesnapdirectory
            ;;
    esac
}

## Delete Wget history
## -------------------
function deletewgetlogs()
{
    read -p "[?] Do you want to delete the Wget history? [y/N] " yn
    case $yn in
        [Yy]* )
			securedelete $HOME/.wget-hsts
			echo -e "[+] Wget history deleted\n"
		    ;;
        [Nn]* )
			echo -e "[!] Wget history not deleted\n"
            ;;
        * )
            deletewgetlogs
            ;;
    esac
}

## Delete Xsession errors
## ----------------------
function deletexerrors()
{
    read -p "[?] Do you want to delete the X-session errors? [y/N] " yn
    case $yn in
        [Yy]* )
			securedelete $HOME/.xsession-errors
			echo -e "[+] X-Session errors deleted\n"
		    ;;
        [Nn]* )
			echo -e "[!] X-Session errors not deleted\n"
            ;;
        * )
            deletexerrors
            ;;
    esac
}

## Delete Kate search history
## --------------------------
function deletekatesearch()
{
	if [ -f "$HOME/.config/katerc" ];
	then
        read -p "[?] Do you want to delete the Kate history? [y/N] " yn
	    case $yn in
	        [Yy]* )
                sed -i s/"^Search History=.*"/"Search History="/g $HOME/.config/katerc
                sed -i s/"^Recent Files\[\$e\]=.*"/"Recent Files\[\$e\]="/g $HOME/.config/katerc
                sed -i s/"^Recent URLs\[\$e\]=.*"/"Recent URLs\[\$e\]="/g $HOME/.config/katerc
                truncate -s 0 $HOME/.config/katemetainfos
                echo -e "[+] Kate history deleted\n"
			    ;;
	        [Nn]* )
                echo -e "[!] Kate history not deleted\n"
	            ;;
	        * )
	            deletekatesearch
	            ;;
	    esac
	fi
}

## Delete Sublime-Text history
## ---------------------------
function deletesublimehistory()
{
    read -p "[?] Do you want to delete the Sublime-Text history? [y/N] " yn
    case $yn in
        [Yy]* )
			securedelete $HOME/.config/sublime-text/Local/Session.sublime_session
			echo -e "[+] Sublime-Text history deleted\n"
            ;;
        [Nn]* )
			echo -e "[!] Sublime-Text history not deleted\n"
            ;;
        * )
            deletesublimehistory
            ;;
    esac
}

## Delete trash
## ------------
function deletetrash()
{
    read -p "[?] Do you want to delete the trash folder content? [y/N] " yn
    case $yn in
        [Yy]* )
			trash-empty
			echo -e "[+] Trash folder content deleted\n"
		    ;;
        [Nn]* )
			echo -e "[!] Trash folder content not deleted\n"
            ;;
        * )
            deletetrash
            ;;
    esac
}

## Terminate
## ---------
function terminate()
{
	echo "Process completed"
	sleep 1s
}

## -------------- ##
## EXECUTE SCRIPT ##
## -------------- ##

## Launch
## ------
function launch()
{
    # Retrieve current datetime
	flushtime=`date +%s.%N`

	# Prepare Environment
	clearscreen
	showwarning
	
	# Execute Actions
	deletecachechrome
	deletecachefilezilla
	deletecachefirefox
	deletecachejetbrains
	deletecachekeepassxc
	deletecachethumbs
	deleterecentfiles
	deletesshkeys
	deletesnapdirectory
	deletewgetlogs
	deletexerrors
	deletekatesearch
	deletesublimehistory
	deletetrash

	# Terminate
	terminate

	# Return notice
	endtime=`date +%s.%N`
	runtime=$( echo "$endtime - $flushtime" | bc -l )
	echo "Executed within ${runtime} seconds"
}

## -------- ##
## CALLBACK ##
## -------- ##

launch
